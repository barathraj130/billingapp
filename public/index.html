<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JBS KNIT WEAR — Billing</title>
  <style>
    :root{
      --bg:#f3f7fb;--card:#fff;--accent:#1877f2;--muted:#889aa6;
      --radius:12px;--shadow:0 10px 30px rgba(18,30,50,0.06);
      --sidebar-w:260px;--container-max:1200px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Roboto,Arial;background:var(--bg);color:#0f1720}
    a{color:var(--accent)}
    .app{display:flex;min-height:100vh}

    /* Sidebar */
    .sidebar{width:var(--sidebar-w);background:#fff;padding:20px;border-right:1px solid rgba(15,23,36,0.05)}
    .brand{font-weight:800;font-size:16px;margin-bottom:6px}
    .sub{color:var(--muted);font-size:13px;margin-bottom:14px}
    .nav{display:flex;flex-direction:column;gap:6px}
    .nav button{border:0;background:transparent;text-align:left;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .nav button small{display:block;font-weight:500;color:var(--muted);font-size:12px}
    .nav button.active{background:rgba(24,119,242,0.08);border-left:4px solid var(--accent);padding-left:10px}

    /* Main */
    .main{flex:1;padding:22px;display:flex;justify-content:center}
    .container{width:100%;max-width:var(--container-max)}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .menu-toggle{display:none;border:0;background:transparent;font-size:20px;cursor:pointer}
    .opening{display:flex;gap:8px;align-items:center}
    .panel{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
    .title{font-weight:800;font-size:20px;margin:0}
    .muted{color:var(--muted);font-size:13px}

    /* Inputs & Buttons */
    .input{padding:10px 12px;border-radius:8px;border:1px solid #e9f0f4;background:#fff;min-height:40px;font-size:14px}
    .btn{padding:9px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn.secondary{background:#fff;border:1px solid #e6eef3;color:#0f1720}
    .btn.danger{background:#ff6b57;color:#fff}

    /* Invoice grid */
    .invoice-form{max-width:960px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
    .form-row{display:flex;gap:12px;flex-wrap:wrap}
    .form-row .input{flex:1;min-width:120px}
    .products{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    .prod-row{display:grid;grid-template-columns:40px 1fr 100px 120px 100px 100px 40px;align-items:center;gap:10px;padding:10px;border-radius:10px;border:1px solid #eef4f7;background:#fff}
    .prod-row input{border:0;background:transparent;padding:8px;border-radius:6px}
    .prod-row .amount{text-align:right;font-weight:700}
    .prod-row .remove{background:none;border:none;color:#999;cursor:pointer;font-weight:700}
    .totals{display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin-top:10px}
    @media (max-width:900px){
      .app{flex-direction:column}
      .sidebar{position:fixed;left:0;top:0;bottom:0;transform:translateX(-120%);transition:transform .2s;z-index:50}
      .sidebar.open{transform:translateX(0)}
      .menu-toggle{display:inline-block}
      .main{padding:10px}
      .prod-row{grid-template-columns:1fr 80px 100px 80px 80px}
    }
  </style>
</head>
<body>
<div class="app">
  <aside id="sidebar" class="sidebar">
    <div class="brand">JBS KNIT WEAR — Billing</div>
    <div class="sub">Simple billing for retail</div>
    <nav class="nav" id="nav">
      <button data-view="dashboard" class="active">Dashboard<small>Quick totals & recent</small></button>
      <button data-view="transactions">Transactions<small>Income & expense add</small></button>
      <button data-view="create">Create Invoice<small>Add products & save</small></button>
      <button data-view="invoices">Invoices<small>Saved invoices</small></button>
      <button data-view="printable">Printable<small>View / print</small></button>
    </nav>
    <div class="muted" style="margin-top:15px;">Tip: Save then Print from invoice view.</div>
  </aside>

  <div class="main">
    <div class="container">
      <div class="page-header">
        <div style="display:flex;align-items:center;gap:10px">
          <button id="menuToggle" class="menu-toggle">☰</button>
          <h1 class="title">Billing</h1>
          <div class="muted">— manage invoices & quick sales</div>
        </div>
        <div class="opening">
          <label class="muted">Opening balance</label>
          <input id="openingInput" class="input" type="number" value="0" style="width:120px" />
          <button id="setOpening" class="btn">Set</button>
          <button id="clearOpening" class="btn secondary">Clear</button>
        </div>
      </div>

      <!-- CREATE INVOICE -->
      <section id="view-create" class="panel">
        <div style="font-weight:800;font-size:18px;margin-bottom:6px">Create Invoice</div>
        <div class="invoice-form">
          <div class="form-row">
            <input id="invoiceNo" class="input" placeholder="Invoice no (auto)">
            <input id="invoiceDate" class="input" type="date">
            <input id="customerName" class="input" placeholder="Customer name">
          </div>

          <div class="form-row">
            <label class="muted">Payment Method</label>
            <select id="paymentMethod" class="input" style="width:160px">
              <option value="Cash">Cash</option>
              <option value="GPay">GPay</option>
              <option value="Card">Card</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <div style="font-weight:700">Products</div>
            <div>
              <button id="addProduct" class="btn">+ Add</button>
              <button id="clearProducts" class="btn secondary">Clear</button>
              <button id="recalc" class="btn secondary">Recalc</button>
            </div>
          </div>

          <div id="products" class="products"></div>

          <div class="totals">
            <div>Subtotal: <span id="subtotal" style="font-weight:700">₹0.00</span></div>
            <div>Tax % <input id="taxPercent" type="number" class="input" style="width:80px" value="0"> 
              <span id="taxAmount" style="font-weight:700">₹0.00</span></div>
            <div>Total: <span id="total" style="font-weight:700">₹0.00</span></div>
          </div>

          <div style="display:flex;gap:10px;margin-top:10px">
            <button id="saveInvoice" class="btn">Save</button>
            <button id="printInvoice" class="btn secondary">Print</button>
            <button id="resetData" class="btn danger">Reset</button>
          </div>
        </div>
      </section>

      <section id="view-invoices" class="panel" style="display:none">
        <h3>Saved Invoices</h3>
        <div id="invoicesList"></div>
      </section>

    </div>
  </div>
</div>

<script>
const el = s=>document.querySelector(s);
const money=v=>'₹'+(Number(v||0)).toFixed(2);
const fmt=v=>(Number(v||0)).toFixed(2);
const escapeHtml=s=>String(s||'').replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));

let state={invoices:[],productsDefault:4};

// Sidebar
document.getElementById('menuToggle').onclick=()=>document.getElementById('sidebar').classList.toggle('open');

// Add product row
const productsEl=el('#products');
function makeRow(i){
  const row=document.createElement('div');
  row.className='prod-row';
  row.innerHTML=`<div>${i}</div>
  <input class="prod-desc" placeholder="Product description">
  <input class="prod-qty" type="number" min="0" value="0">
  <input class="prod-rate" type="number" min="0" step="0.01" value="0">
  <input class="prod-disc" type="number" min="0" step="0.01" value="0">
  <div class="amount">₹0.00</div>
  <button class="remove">x</button>`;
  row.querySelectorAll('input').forEach(inp=>inp.oninput=recalcTotals);
  row.querySelector('.remove').onclick=()=>{row.remove();recalcTotals();};
  return row;
}
function initProducts(n){productsEl.innerHTML='';for(let i=1;i<=n;i++)productsEl.append(makeRow(i));}
el('#addProduct').onclick=()=>productsEl.append(makeRow(productsEl.children.length+1));
el('#clearProducts').onclick=()=>{if(confirm('Clear all products?'))initProducts(state.productsDefault);};

// Recalc totals
function recalcTotals(){
  let subtotal=0;
  [...productsEl.children].forEach(r=>{
    const q=+r.querySelector('.prod-qty').value;
    const rt=+r.querySelector('.prod-rate').value;
    const d=+r.querySelector('.prod-disc').value;
    let amt=q*rt;
    if(d)amt-=amt*(d/100);
    r.querySelector('.amount').textContent=money(amt);
    subtotal+=amt;
  });
  const taxPct=+el('#taxPercent').value;
  const taxAmt=subtotal*(taxPct/100);
  el('#subtotal').textContent=money(subtotal);
  el('#taxAmount').textContent=money(taxAmt);
  el('#total').textContent=money(subtotal+taxAmt);
}
el('#taxPercent').oninput=recalcTotals;
el('#recalc').onclick=recalcTotals;

// Collect invoice
function collectInvoice(){
  const rows=[...productsEl.children].map(r=>{
    return{
      desc:r.querySelector('.prod-desc').value,
      qty:+r.querySelector('.prod-qty').value,
      rate:+r.querySelector('.prod-rate').value,
      disc:+r.querySelector('.prod-disc').value,
      amount:parseFloat(r.querySelector('.amount').textContent.replace(/[₹,]/g,''))||0
    };
  });
  const subtotal=rows.reduce((a,b)=>a+b.amount,0);
  const taxPct=+el('#taxPercent').value;
  const taxAmt=subtotal*(taxPct/100);
  return{
    id:el('#invoiceNo').value||'INV-'+Date.now(),
    date:el('#invoiceDate').value||new Date().toISOString().slice(0,10),
    customer:el('#customerName').value,
    payment:el('#paymentMethod').value,
    rows,subtotal,taxPct,taxAmt,total:subtotal+taxAmt
  };
}

// Save + Print
el('#saveInvoice').onclick=()=>{
  const inv=collectInvoice();
  state.invoices.push(inv);
  localStorage.setItem('invoices',JSON.stringify(state.invoices));
  alert('Invoice saved');
};
el('#printInvoice').onclick=()=>{
  const inv=collectInvoice();
  const w=window.open();
  w.document.write(`<!doctype html><html><head><meta charset='utf-8'><title>Invoice</title>
  <style>body{font-family:Arial;padding:20px;}table{width:100%;border-collapse:collapse;}td,th{border:1px solid #ddd;padding:8px;}</style></head>
  <body><h2>JBS KNIT WEAR</h2><div>Date: ${inv.date}</div>
  <div>Invoice ID: ${inv.id}</div><div>Customer: ${escapeHtml(inv.customer||'')}</div>
  <div>Payment: ${escapeHtml(inv.payment||'')}</div>
  <table><tr><th>#</th><th>Product</th><th>Qty</th><th>Rate</th><th>Amount</th></tr>
  ${inv.rows.map((r,i)=>`<tr><td>${i+1}</td><td>${escapeHtml(r.desc)}</td><td>${r.qty}</td><td>${fmt(r.rate)}</td><td>${fmt(r.amount)}</td></tr>`).join('')}
  </table><h3>Total: ₹${fmt(inv.total)}</h3></body></html>`);
  w.document.close();
};

// Reset
el('#resetData').onclick=()=>{if(confirm('Delete all invoices?')){localStorage.clear();state.invoices=[];alert('All data cleared');}}

// Init
function init(){
  el('#invoiceDate').value=new Date().toISOString().slice(0,10);
  initProducts(state.productsDefault);
  const saved=localStorage.getItem('invoices');
  if(saved)state.invoices=JSON.parse(saved);
}
init();
</script>
</body>
</html>
