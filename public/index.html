<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JBS KNIT WEAR — Billing</title>

  <style>
    :root{
      --bg:#f4f6f8; --panel:#fff; --muted:#9aa3ae; --accent:#1777ff;
      --radius:12px; --shadow: 0 8px 24px rgba(24,39,75,0.06);
      --sidebar-w:260px;
    }

    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#1f2d3d;background:var(--bg);}

    /* header */
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:transparent}
    .brand{display:flex;align-items:center;gap:16px}
    .brand h1{font-size:18px;margin:0;font-weight:800}
    .brand small{color:var(--muted);margin-left:6px;font-weight:500}

    /* layout */
    .layout{display:flex;min-height:calc(100vh - 56px);}
    .sidebar{width:var(--sidebar-w);background:transparent;padding:28px 18px;border-right:0;box-sizing:border-box}
    .sidebar .menu{background:var(--panel);border-radius:12px;padding:18px;box-shadow:var(--shadow)}
    .sidebar h3{margin:0 0 12px 0;font-size:14px}
    .nav{display:flex;flex-direction:column;gap:8px}
    .nav a{display:block;padding:12px 14px;border-radius:10px;color:#123;font-weight:700;text-decoration:none}
    .nav a.small{font-weight:500;color:var(--muted);font-size:13px;padding-left:18px}
    .nav a.active{background:linear-gradient(90deg,#eef6ff,#fff);border-left:4px solid var(--accent);}

    /* main */
    .main{flex:1;padding:28px;box-sizing:border-box;display:grid;grid-template-columns:1fr 360px;gap:28px}
    .panel{background:var(--panel);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow)}
    .panel.h1{padding:28px}

    .h1{font-size:28px;margin:0 0 8px 0}
    .muted{color:var(--muted)}

    .stat-row{display:flex;gap:18px;margin-top:12px;flex-wrap:wrap}
    .stat{flex:1;min-width:180px;background:#fff;border-radius:10px;padding:14px;border:1px solid #f0f3f6}
    .stat h4{margin:0;color:var(--muted);font-weight:600;font-size:13px}
    .stat p{margin:8px 0 0 0;font-weight:800;font-size:20px}

    /* invoice right column */
    .invoice-panel{position:sticky;top:24px}
    .form-row{display:flex;gap:8px;margin-bottom:12px}
    .input, .small-input{display:block;padding:10px 12px;border-radius:8px;border:1px solid #ebf0f3;background:#fff;min-width:0}
    .input{width:100%}
    .small-input{width:90px}
    .btn{display:inline-block;padding:8px 14px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn.ghost{background:#fff;border:1px solid #e6eaee;color:#333}
    .btn.reset{background:#ff7b5a}

    /* product rows */
    .products{margin-top:10px}
    .prod-row{display:flex;gap:8px;align-items:center;padding:10px;border-radius:10px;border:1px solid #eef3f7;margin-bottom:10px}
    .prod-index{width:36px;text-align:center;font-weight:700;color:var(--muted)}
    .prod-desc{flex:1}
    .prod-desc input{width:100%}
    .prod-input{width:72px}

    .totals{display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin-top:6px}
    .totals .line{display:flex;gap:16px;align-items:center}
    .totals strong{font-size:18px;margin-left:8px}

    /* table recent */
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid #f0f3f6;text-align:left}
    th{background:transparent;color:var(--muted);font-weight:700}

    /* responsive */
    @media (max-width:1100px){
      .main{grid-template-columns:1fr 360px}
      .sidebar{display:block}
    }
    @media (max-width:900px){
      .layout{flex-direction:column}
      .sidebar{width:100%;order:2;padding:12px}
      .main{grid-template-columns:1fr;gap:14px;padding:14px}
      .invoice-panel{position:static}
      .brand h1{font-size:16px}
    }
    /* small device touch improvements */
    input[type="number"]{-moz-appearance:textfield}
    input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
  </style>
</head>
<body>

  <div class="topbar">
    <div class="brand">
      <button id="menuToggle" aria-label="toggle menu" style="background:none;border:0;font-size:22px;cursor:pointer">☰</button>
      <div>
        <h1>JBS KNIT WEAR — Billing</h1>
        <small class="muted">Simple billing for retail</small>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:12px">
      <label class="muted" style="margin-right:8px">Opening balance (today)</label>
      <input id="openingInput" class="input small-input" style="width:120px" placeholder="0.00" />
      <button id="setOpening" class="btn">Set</button>
      <button id="clearOpening" class="btn ghost">Clear</button>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="menu">
        <h3>JBS KNIT WEAR — <span class="muted">Billing</span></h3>
        <nav class="nav" id="nav">
          <a href="#" data-view="dashboard" class="active">Dashboard <div class="small muted" style="font-size:12px">Quick totals & recent</div></a>
          <a href="#" data-view="transactions">Transactions <div class="small muted" style="font-size:12px">Income & expense quick add</div></a>
          <a href="#" data-view="create">Create Invoice <div class="small muted" style="font-size:12px">Add products & save</div></a>
          <a href="#" data-view="invoices">Invoices <div class="small muted" style="font-size:12px">Saved invoices list</div></a>
          <a href="#" data-view="printable">Printable template <div class="small muted" style="font-size:12px">View / print invoice</div></a>
        </nav>
        <p class="muted" style="font-size:12px;margin-top:12px">Tip: Save then Print from the invoice view.</p>
      </div>
    </aside>

    <main class="main">
      <!-- left content column -->
      <section>
        <div class="panel h1">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap">
            <div>
              <h2 class="h1">Billing Dashboard</h2>
              <p class="muted">Quick overview of today's totals and recent activity</p>
            </div>
            <div style="color:var(--accent);font-weight:800">Profit: <span id="profitVal">₹0.00</span></div>
          </div>

          <div class="stat-row">
            <div class="stat">
              <h4>Total Income</h4>
              <p id="totalIncome">₹0.00</p>
            </div>
            <div class="stat">
              <h4>Total Expense</h4>
              <p id="totalExpense">₹0.00</p>
            </div>
            <div class="stat">
              <h4>Profit</h4>
              <p id="profit">₹0.00</p>
            </div>
          </div>

          <div style="margin-top:18px;">
            <h3 style="margin:0 0 10px 0">Recent transactions</h3>
            <div class="panel" style="padding:0">
              <table id="recentTable">
                <thead><tr><th>Date</th><th>Type</th><th>Category</th><th>Amount</th></tr></thead>
                <tbody><tr><td colspan="4" class="muted">No recent transactions</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- right invoice column -->
      <aside class="invoice-panel">
        <div class="panel" id="invoicePanel">
          <h3 style="margin-top:0">Create Invoice <small class="muted" style="float:right">Tip: enter product, qty & rate — amounts auto</small></h3>

          <div class="form-row">
            <input id="invoiceNo" class="input" placeholder="Invoice no (auto)" />
            <input id="invoiceDate" class="input" placeholder="dd/mm/yyyy" />
          </div>
          <div class="form-row">
            <input id="customerName" class="input" placeholder="Customer name" />
          </div>

          <div style="margin-top:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <h4 style="margin:0">Products</h4>
              <div>
                <button id="addProd" class="btn">+ Add</button>
                <button id="clearProd" class="btn ghost">Clear</button>
                <button id="recalc" class="btn ghost">Recalc</button>
              </div>
            </div>

            <div id="products" class="products" aria-live="polite">
              <!-- product rows inserted here -->
            </div>

            <div class="totals">
              <div class="line"><div class="muted">Subtotal:</div><strong id="subtotal">₹0.00</strong></div>
              <div class="line" style="align-items:center">
                <div class="muted" style="margin-right:6px">Tax %:</div>
                <input id="taxPct" class="small-input" type="number" value="0" min="0" />
                <strong style="margin-left:18px">₹<span id="taxVal">0.00</span></strong>
              </div>
              <div class="line"><div class="muted">Total</div><strong id="total">₹0.00</strong></div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px">
              <button id="saveInv" class="btn">Save</button>
              <button id="printInv" class="btn ghost">Print</button>
              <button id="resetData" class="btn reset">Reset</button>
            </div>
          </div>
        </div>
      </aside>
    </main>
  </div>

<script>
/* ---------- Utilities ---------- */
function money(n){ return Number(n||0).toLocaleString('en-IN',{maximumFractionDigits:2,minimumFractionDigits:2}) }
function el(q){ return document.querySelector(q) }
function create(tag,attrs){ const t=document.createElement(tag); if(attrs) Object.keys(attrs).forEach(k=>t.setAttribute(k,attrs[k])); return t }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]) }

/* ---------- State (localStorage-backed) ---------- */
const STORAGE_KEY = 'billingapp_invoices_v1'
function loadInvoices(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]') }catch(e){ return [] } }
function saveInvoices(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)) }

/* ---------- Dashboard & transactions (simple) ---------- */
function renderRecent(){ const invoices = loadInvoices().slice(-6).reverse()
  const tbody = document.querySelector('#recentTable tbody'); tbody.innerHTML = ''
  if(!invoices.length){ tbody.innerHTML = '<tr><td colspan="4" class="muted">No recent transactions</td></tr>'; return }
  invoices.forEach(inv=>{
    const tr = document.createElement('tr')
    tr.innerHTML = `<td>${inv.date||''}</td><td>income</td><td>sales</td><td>${money(inv.total)}</td>`
    tbody.appendChild(tr)
  })
  updateSummary()
}
function updateSummary(){
  const invoices = loadInvoices()
  const income = invoices.reduce((s,i)=>s + Number(i.total||0),0)
  const expense = 0
  document.getElementById('totalIncome').textContent = '₹' + money(income)
  document.getElementById('totalExpense').textContent = '₹' + money(expense)
  document.getElementById('profit').textContent = '₹' + money(income-expense)
  document.getElementById('profitVal').textContent = '₹' + money(income-expense)
}

/* ---------- Invoice UI ---------- */
const productsEl = document.getElementById('products')
let productRows = []

function newProductRow(desc='', qty='', rate='', disc=0){
  const rowIndex = productRows.length + 1
  const row = create('div'); row.className='prod-row'
  row.innerHTML = `
    <div class="prod-index">${rowIndex}</div>
    <div class="prod-desc"><input class="input" placeholder="Product" value="${escapeHtml(desc)}" /></div>
    <div><input class="input prod-input qty" type="number" min="0" placeholder="Qty" value="${escapeHtml(qty)}" /></div>
    <div><input class="input prod-input rate" type="number" min="0" placeholder="Rate" value="${escapeHtml(rate)}" /></div>
    <div><input class="input prod-input disc" type="number" min="0" placeholder="Disc%" value="${escapeHtml(disc)}" /></div>
    <div style="width:88px;text-align:right"><input class="input prod-input amount" readonly placeholder="Amount" /></div>
    <div><button class="btn ghost remove">x</button></div>
  `
  productsEl.appendChild(row)
  const amt = row.querySelector('.amount')
  const qtyEl = row.querySelector('.qty')
  const rateEl = row.querySelector('.rate')
  const discEl = row.querySelector('.disc')

  function recalcRow(){
    const q = Number(qtyEl.value||0)
    const r = Number(rateEl.value||0)
    const d = Number(discEl.value||0)
    const raw = q * r
    const net = raw - (raw * (d/100))
    amt.value = money(net)
    recalcTotals()
  }
  qtyEl.addEventListener('input', recalcRow)
  rateEl.addEventListener('input', recalcRow)
  discEl.addEventListener('input', recalcRow)
  row.querySelector('.remove').addEventListener('click', ()=>{
    productsEl.removeChild(row)
    productRows = productRows.filter(x=>x!==row)
    rebuildIndices()
    recalcTotals()
  })

  productRows.push(row)
  recalcTotals()
}

function rebuildIndices(){
  productRows = Array.from(productsEl.querySelectorAll('.prod-row'))
  productRows.forEach((r,i)=> r.querySelector('.prod-index').textContent = i+1 )
}

function recalcTotals(){
  const rows = Array.from(productsEl.querySelectorAll('.prod-row'))
  let subtotal=0
  rows.forEach(r=>{
    const q = Number(r.querySelector('.qty').value||0)
    const rate = Number(r.querySelector('.rate').value||0)
    const disc = Number(r.querySelector('.disc').value||0)
    const raw = q*rate
    const net = raw - (raw*disc/100)
    const aEl = r.querySelector('.amount')
    aEl.value = money(net)
    subtotal += net
  })
  const taxPct = Number(el('#taxPct').value||0)
  const taxVal = subtotal * (taxPct/100)
  document.getElementById('subtotal').textContent = '₹' + money(subtotal)
  document.getElementById('taxVal').textContent = money(taxVal)
  document.getElementById('total').textContent = '₹' + money(subtotal + taxVal)
}

/* ---------- Save / print ---------- */
function gatherInvoice(){
  const rows = Array.from(productsEl.querySelectorAll('.prod-row')).map(r=>{
    return {
      desc: r.querySelector('.prod-desc input').value || '',
      qty: Number(r.querySelector('.qty').value||0),
      rate: Number(r.querySelector('.rate').value||0),
      disc: Number(r.querySelector('.disc').value||0),
      amount: Number((r.querySelector('.amount').value||'0').replace(/,/g,'')) || 0
    }
  }).filter(r=>r.qty || r.rate || r.desc)
  const subtotal = rows.reduce((s,r)=>s + r.amount,0)
  const taxPct = Number(el('#taxPct').value||0)
  const tax = subtotal * (taxPct/100)
  const total = subtotal + tax
  return {
    id: el('#invoiceNo').value || 'INV-' + (Date.now()),
    date: el('#invoiceDate').value || new Date().toLocaleDateString(),
    customer: el('#customerName').value || '',
    rows, subtotal, tax, total
  }
}

function saveInvoice(){
  const inv = gatherInvoice()
  if(inv.rows.length === 0){ alert('Add at least one product'); return }
  const invoices = loadInvoices()
  invoices.push(inv)
  saveInvoices(invoices)
  renderRecent()
  alert('Saved invoice ' + inv.id)
  // clear form
  clearInvoiceForm()
}

function clearInvoiceForm(){
  el('#customerName').value = ''
  el('#invoiceNo').value = ''
  el('#invoiceDate').value = new Date().toLocaleDateString()
  productsEl.innerHTML = ''
  productRows = []
  newProductRow()
  recalcTotals()
}

/* ---------- Printable HTML generator (safe template literal) ---------- */
function renderPrintable(inv){
  const rowsHtml = inv.rows.map((r,i)=> {
    return `<tr>
      <td style="padding:6px;border:1px solid #ddd">${i+1}</td>
      <td style="padding:6px;border:1px solid #ddd">${escapeHtml(r.desc)}</td>
      <td style="padding:6px;border:1px solid #ddd;text-align:center">${r.qty}</td>
      <td style="padding:6px;border:1px solid #ddd;text-align:right">${money(r.rate)}</td>
      <td style="padding:6px;border:1px solid #ddd;text-align:right">${money(r.amount)}</td>
    </tr>`
  }).join('\n')

  return `<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Invoice ${escapeHtml(inv.id)}</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;padding:20px;color:#111}
.header{display:flex;justify-content:space-between;align-items:center}
h1{margin:0 0 6px 0}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:8px;border:1px solid #ddd}
.totals{margin-top:18px;display:flex;justify-content:flex-end}
.right{width:300px}
.small{color:#666;font-size:13px}
</style>
</head>
<body>
  <div class="header">
    <div>
      <h1>JBS KNIT WEAR</h1>
      <div class="small">3(2)/2B, Nesavalar Colony 2nd Street, P.N.Road, Tirupur - 641 602.</div>
      <div style="margin-top:6px"><strong>GSTIN:</strong> 33CKAPJ7513F1ZK</div>
    </div>
    <div style="text-align:right">
      <div><strong>No:</strong> ${escapeHtml(inv.id)}</div>
      <div><strong>Date:</strong> ${escapeHtml(inv.date)}</div>
      <div style="margin-top:8px" class="small">Printed: ${new Date().toLocaleString()}</div>
    </div>
  </div>

  <div style="margin-top:18px"><strong>Customer:</strong> ${escapeHtml(inv.customer)}</div>

  <table aria-label="Invoice items">
    <thead>
      <tr>
        <th style="width:40px">S.No</th>
        <th>Particulars</th>
        <th style="width:80px">Qty</th>
        <th style="width:100px">Rate (Rs)</th>
        <th style="width:120px">Amount (Rs)</th>
      </tr>
    </thead>
    <tbody>
      ${rowsHtml}
    </tbody>
  </table>

  <div class="totals">
    <div class="right">
      <div style="display:flex;justify-content:space-between"><div>Subtotal:</div><div>₹${money(inv.subtotal)}</div></div>
      <div style="display:flex;justify-content:space-between"><div>Tax:</div><div>₹${money(inv.tax)}</div></div>
      <div style="display:flex;justify-content:space-between;font-weight:800;margin-top:10px"><div>Total:</div><div>₹${money(inv.total)}</div></div>
    </div>
  </div>

  <div style="margin-top:40px">
    <div style="float:right;text-align:center">
      <div>For JBS KNIT WEAR</div>
      <br><br><br>
      <div>Authorized Signatory</div>
    </div>
    <div style="clear:both"></div>
  </div>

  <script>window.print()</script>
</body>
</html>`
}

/* ---------- Reset logic ---------- */
function confirmReset(){
  const txt = prompt('Type RESET to confirm permanent wipe of data:')
  if(txt !== 'RESET'){ alert('Reset cancelled (confirmation not matched).'); return }
  localStorage.removeItem(STORAGE_KEY)
  renderRecent()
  alert('All data cleared.')
}

/* ---------- Wire up UI ---------- */
document.getElementById('addProd').addEventListener('click', ()=> newProductRow())
document.getElementById('clearProd').addEventListener('click', ()=> { productsEl.innerHTML=''; productRows=[]; newProductRow(); recalcTotals() })
document.getElementById('recalc').addEventListener('click', recalcTotals)
document.getElementById('saveInv').addEventListener('click', saveInvoice)
document.getElementById('printInv').addEventListener('click', ()=>{
  const inv = gatherInvoice()
  const win = window.open()
  win.document.write(renderPrintable(inv))
  win.document.close()
})
document.getElementById('resetData').addEventListener('click', confirmReset)
document.getElementById('setOpening').addEventListener('click', ()=>{
  const v = Number(el('#openingInput').value||0)
  localStorage.setItem('opening_today', v)
  alert('Opening balance set: ₹' + money(v))
})
document.getElementById('clearOpening').addEventListener('click', ()=>{
  localStorage.removeItem('opening_today'); el('#openingInput').value=''; alert('Opening cleared')
})
el('#taxPct').addEventListener('input', recalcTotals)

/* menu navigation (single page style) */
document.querySelectorAll('#nav a').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault()
    document.querySelectorAll('#nav a').forEach(x=>x.classList.remove('active'))
    a.classList.add('active')
    const view = a.getAttribute('data-view')
    if(view==='create'){
      // scroll right column into view on small screens
      if(window.innerWidth < 900) window.scrollTo({top: document.querySelector('.invoice-panel').offsetTop-20, behavior:'smooth'})
    }
  })
})

/* menu toggle for small screens */
document.getElementById('menuToggle').addEventListener('click', ()=>{
  const sb = document.querySelector('.sidebar')
  if(sb.style.display === 'none' || getComputedStyle(sb).display==='none'){ sb.style.display='block' } else { sb.style.display='none' }
})

/* initial */
(function init(){
  // invoice date
  el('#invoiceDate').value = new Date().toLocaleDateString()
  // one product row
  newProductRow()
  // load saved invoices into dashboard
  renderRecent()
  // adapt sidebar for small screens
  if(window.innerWidth < 900) document.querySelector('.sidebar').style.display='none'
})()

</script>
</body>
</html>
